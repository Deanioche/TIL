# **구문 분석**

## **학습 목표**

어휘 분석의 개념을 이해하고 토큰의 종류를 설명할 수 있다.

구문 분석을 위한 유도와 파스 트리의 개념을 설명할 수 있다.

모호한 문법의 개념을 이해하고 모호성을 제거하는 방법을 설명할 수 있다.
___

## **1. 어휘 분석**

### **프로그램 분석**
```c
int x12;
x12 = 1 + 5 * 2;
if x12>10 then ...
```
위와 같이 가상의 프로그램이 있다면 컴퓨터는 이 프로그램을 보고 실행하기 위해 분석한다.

1. 문자의 분석
    - i, n, t, x, 1, 2, ;, =, +, 5, *, f, >, …

2. 어휘의 분석
    - int, x12, ;, =, 1, +, 5, if, >, 10, then, …

3. 구문의 분석
    - <선언문> ::= <자료형> <변수> ;
    - <대입문> ::= <변수> = <수식> ;

### **어휘 분석**

- 프로그램에서 사용된 단어를 구별해 냄
    - "x12"가 하나의 덩어리(어휘)인지 파악.
- 토큰:어휘 분석을 통해 얻어지는 결과
    - 연산자, 구분자, 식별자, 예약어 등
        - 연산자 : +, -, *, /, = 등
        - 구분자 : ,(콤마), ;, [, ] 등

- ## **식별자(identifier)**

    - 변수나 함수 등의 이름을 나타내는 토큰
        - x12, printf 등

    - 전통적인 식별자: 문자와 숫자로 구성, 첫 글자는 문자
        - x12는 변수나 함수라고 딱 정해져 있지는 않지만 식별자 규칙에 따라 토큰으로 정의됨. 
        - 언어들 마다 식별자 규칙이 다르게 정의될 수도 있음.

```c
// 식별자(identifier)는 하나의 문자(letter)이거나, identifier 다음 letter나 digit으로 이어진다.
<identifier> ::= <letter> | <identifier><letter> | <identifier><digit>

// letter의 정의
<letter> ::= A | B | C | ... | X | Y | Z | a | b | ... | z

// digit의 정의
<digit> ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
```

- ## **예약어(reserved word)**

    - 프로그래밍 언어 자체에 정의되어 포함된 토큰
        - if,for,int 등

    - 식별자와 구문 구조가 같지만 식별자로 사용 못함
        - 사용자 재정의 불가

    - 어휘 분석기에서 예약어를 별도로 관리한다.

___

## **2. 구문 분석**

어휘 분석으로 토큰들이 다 나왔으므로,  
이 어휘들로 구문 규칙을 통해 최종적인 프로그램이 만들어지는 과정.

### **유도(derivation)**
- 구문 규칙을 이용하여 주어진 프로그램을 만들어 내는 과정
- 유도가 가능하면 문법적 오류가 없는 유효한 프로그램임.

- 예시
    ```c
    //수식 
    1+5*2

    // 구문 규칙
    <exp> ::= <exp>+<exp> | <exp>-<exp> | <exp>*<exp> | <exp>/<exp> | (<exp>) | <digit>
    <digit> ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
    ```

    일 때, 다음과 같은 순서로 구문이 분석된다.
    ```
    <exp>
    → <exp>+<exp>
    → <exp>+<exp>*<exp>
    → <exp>+<exp>*<digit>
    → <exp>+<exp>*2
    → <exp>+<digit>*2
    → <exp>+5*2
    → <digit>+5*2
    → 1+5*2
    ```
    해당 수식이 정상적으로 유도가 되었으므로,   
    이 수식은 오류가 없는 잘 작성된 구문이라고 판단되어지며 구문 분석이 완료된다.

### **파스 트리(parse tree)**

- 유도를 **트리 형태**로 나타낸 것

- 구조
    - 루트 노드 : 시작 비단말 기호
    - 비단말 노드 : 비단말 기호
    - 단말 노드 : 단말 기호 

- 단말 노드를 왼쪽부터 오른쪽으로 차례로 나열하면 주어진 프로그램이 됨

- 파스 트리 예
    ![image](https://user-images.githubusercontent.com/66513003/137147959-7e70d668-1dec-4ef7-bd70-3b7a26d91509.png)

    - 루트 노드 (시작 비단말 기호) : \<exp>
    - 비단말 노드 (비단말 기호) : \<exp>, \<digit>
    - 단말 노드 (단말 기호) : 1, +, 5, *, 2

    - 파스트리의 단말 노드 왼쪽부터 오른쪽으로 쭉 나열했을 때, 수식과 동일하게 나왔다면 정상적인 파스 트리이며, 구문 규칙에 맞게 잘 만들어진 프로그램임을 의미한다.

- 오류가 있는 표현
    ![image](https://user-images.githubusercontent.com/66513003/137148255-78724baa-7d90-4032-95fd-16f832306a50.png)

___

## **3. 모호성**

### **파스 트리**

- 주어진 표현에 대한 파스 트리가 존재하면 구문에 부합하는 표현임
- 만약 주어진 표현에 대한 파스 트리가 여러 개 존재한다면?

- 구문론 관점
    - 파스 트리가 존재하므로 구문에는 부합

- 의미론 관점
    - 주어진 표현이 서로 다른 의미로 해석될 수 있음

![image](https://user-images.githubusercontent.com/66513003/137149371-62116155-d048-414d-9b91-a2ad72fe79da.png)

- 연산자의 우선순위가 없으면 두 경우가 발생하므로 위 구문 규칙은 모호한 문법.

### **모호한 문법**

- 동일한 표현에 대해 서로 다른 파스 트리가 만들어지는 문법

- 문제점
    - 하나의 프로그램이 서로 다른 결과를 도출할 수 있음
    - 프로그래머의 의도와는 다르게 해석되어 잘못된 결과를 도출할 수 있는 위험을 내포

### **모호성 제거**

- 문법의 명확화
    - 의도하지 않은 의미로 해석되지 않도록 모호한 문법을 명확하게 변경
    - 새로운 비단말 기호와 새로운 구문 규칙을 추가하여 변경
    - 예 : 연산자 우선순위, 좌결합 연산자, 중첩된 if문의 else

- 연산자 우선순위
    - +, - : 가장 낮음
    - *, / : 중간
    - ( )  : 가장 높음

- 예
    ![image](https://user-images.githubusercontent.com/66513003/137151076-c770b7d8-f61b-46d0-9930-e6c7756ef22c.png)

- 연산자와 괄호에는 차등된 연산 우선순위가 있어야 하지만, 모호한 문법에는 그런게 없다.
- 파스 트리를 만들 때는, 연산자 우선순위가 역순이 되도록 트리를 만들어주어야 한다. (+가 위, *가 아래)

- 파스 트리
    ![image](https://user-images.githubusercontent.com/66513003/137153195-a8feb978-4496-49e1-a05f-5b1352107fcf.png)

- 좌결합 연산자
    - 우선순위가 동일한 연산자 사이의 계산 순서는 왼쪽이 우선
    - 이 연산 규칙 또한 구문 규칙에 포함이 되어야 한다.

    - 규칙 수정 전 : 5 - 3 + 2의 결과로 0이 나오게 된다.
        ![image](https://user-images.githubusercontent.com/66513003/137154373-536fbd94-b538-49a2-b9a3-d6754e3880b7.png)

    - 규칙 수정 (모호성 제거)
        ![image](https://user-images.githubusercontent.com/66513003/137154805-a323b0f1-f522-49be-980a-545b6cab12ee.png)

    - 수정 후 트리
        ![image](https://user-images.githubusercontent.com/66513003/137154943-a48ddd05-c71b-42ca-8060-b7d9b441c5e8.png)

- 중첩된 if문의 else
    ![image](https://user-images.githubusercontent.com/66513003/137155334-861603b5-9301-4f57-9db9-6e7d7f41642a.png)
    - 두 가지의 파스 트리가 생성될 수 있으므로 모호한 문법이다.

    - 모호성 제거
        - 중첩된 if문의 else
            - else문 앞에 나론 if문들 중 다른 else문과 짝이 되지 않은 가장 가까운 if문과 짝이 되도록 함.

        ![image](https://user-images.githubusercontent.com/66513003/137156297-be51302b-7865-45f3-9399-ac137e5acfae.png)
        - \<if문>의 else 앞에 나오는 \<문장2>에는 항상 else가 있도록 한다.

    - 규칙 수정 후
        ![image](https://user-images.githubusercontent.com/66513003/137156754-f264186d-ec02-4304-a817-7a6152e947ae.png)
___     

## **학습 정리**

프로그램의 분석은 크게 **어휘 분석**과 **구문 분석**으로 나눌 수 있다.

어휘 분석을 통해 프로그램에서 사용된 단어인 **토큰**을 구별해 낸다. 토큰의 종류에는 연산자, 구분자, 식별자, 예약어 등이 있다.

**식별자**는 변수나 함수 등의 이름을 나타내는 토큰이다.

**예약어**는 프로그래밍 언어 자체에 정의되어 포함된 토큰으로 사용자 재정의가 불가능하다.

**유도**는 구문 규칙을 이용하여 주어진 프로그램을 만들어 내는 과정으로, 유도가 가능하다면 주어진 프로그램은 문법적 오류가 없다.

**파스 트리**는 유도를 트리 형태로 나타낸 것으로, 루트 노드는 시작 비단말 기호, 단말 노드는 단말 기호가 된다. 단말 노드를 왼쪽부터 오른쪽으로 차례로 나열하면 주어진 프로그램이 된다.

주어진 표현에 대한 파스 트리가 존재하면 구문에 부합하는 표현이지만, 파스 트리가 존재하지 않으면 오류가 있는 표현이다.

모호한 문법은 동일한 표현에 대해 서로 다른 파스 트리가 만들어지는 문법으로, 하나의 프로그램이 서로 다른 결과를 도출할 수 있는 위험을 내포하고 있다.

모호한 문법은 문법을 명확하게 변경하여 모호성을 제거해야 한다.