# 정규화 (Normalization)

## **목차**
### 1. 좋은 릴레이션과 나쁜 릴레이션
### 2. 함수적 종속성
### 3. 정규화

<br>
<br>
<br>

# **1. 좋은 릴레이션과 나쁜 릴레이션**
- 나쁜 릴레이션의 예
- 좋은 릴레이션의 개념
- 좋은 릴레이션

## **나쁜 릴레이션의 예**

1. 데이터의 중복
    - 일관성 훼손으로 데이터 관리가 비효율적.
    - 저장 공간 낭비

2. 갱신 이상
    - 삽입 이상 : 레코드 추가시 불필요한 컬럼의 값 없이는 추가하지 못 하는 경우.
    - 삭제 이상 : 삭제시 의도하지 않았던 다른 데이터가 삭제되는 경우.
    - 수정 이상 : 중복 저장된 레코드를 수정 시 모두 반영이 안되서 데이터베이스의 일관성이 깨지는 경우.

## **좋은 릴레이션의 개념**

1. 컴퓨터 프로그래머적 관점에서의 모델링.

    ```어떻게 데이터를 저장해야 하는가?```

2. 릴레이션의 스키마가 얼마나 효율적으로 실세계를 반영하고 있는지 평가.

3. 고려사항
    - 한 릴레이션 내의 컬럼 간의 관계 분석.
    - 원하지 않는 데이터의 종속과 중복 제거.
    - 새로운 컬럼들이 데이터베이스에 추가될 때 기존 컬럼과의 관계 수정을 최소화.

## **좋은 릴레이션**


- 분류에 맞게 테이블을 분할

<br>
<br>
<br>

# **2. 함수적 종속성**
- 함수적 종속성의 정의
- 함수적 종속성의 확장
- 커버와 카노니컬 커버


## **함수적 종속성의 정의**

1. 릴레이션 인스턴스를 분석하여 속성들 강의 연관관계를 표현한 것.
2. 릴레이션의 효율성을 향상시켜 좋은 릴레이션으로 변환하는데 이용.

`
임의의 릴레이션 스키마 R의 인스턴스 r(R)에 포함되는 서로 다른 두 레코드 r1,r2와 컬럼 집합 X와 Y에 대해, r1[X] = r2[Y]일 때, r1[y] = r2[y]이면 함수적 종속성 X -> Y가 성립한다.
`

>멤버의 등급에 따라 할인율이 달라지는 테이블에서  
등급이 GOLD일때 할인율은 항상 5%이고  
등급이 VIP일때 할인율은 항상 10%이다.  
즉, 멤버의 등급이 같으면 할인율도 같다면,  
`등급이 할인율을 종속한다.`  
`{등급} -> {할인율}`


## **함수적 종속성의 확장**
1. 함수적 종속성은 릴레이션의 효율성 여부에 중요한 판단기준.
1. 그러나 릴레이션의 인스턴스만으로 내재된 모든 함수적 종속성을 찾아내기 어려움.
1. 판별되지 않은 모든 함수적 종속성을 찾기 위해 추론 규칙을 사용하여 함수적 종속성을 확장.
1. 클로저 (Closure)
    - 판별된 함수적 종속성 집합으로부터 유추할 수 있는 모든 함수적 종속성 집합.
        `F+`

## **함수적 종속성 추론 규칙**

1. 재귀성규칙: 𝑋⊇𝑌(X가 Y의 부분집합)이면, 𝑋→𝑌(X는 Y에 종속한다.)이다.
    - `{등급, 할인율} -> {할인율}`

2. 부가성규칙: 𝑋→𝑌이면, 𝑋𝑍→𝑌𝑍이다.
    - `X가 Y에 종속되면, X와 Y에 새로운 컬럼을 추가해도 종속된다.`

3. 이행성규칙: 𝑋→𝑌이고, 𝑌→𝑍이면, 𝑋→𝑍이다.  
    - `X가 Y를 종속하고 Y가 Z를 종속하면, X는 Z를 종속한다.`

4. 분해규칙: 𝑋→𝑌𝑍이면, 𝑋→𝑌이다. 
    - `X가 YZ를 종속하면, X가 Y와 Z를 각각 종속한다.`

5. 합집합규칙: 𝑋→𝑌이고, 𝑋→𝑍이면, 𝑋→𝑌𝑍이다.   
6. 의사이행성규칙: 𝑋→𝑌이고, 𝑊𝑌→𝑍이면, 𝑊𝑋→𝑍이다.

<br>

![image](https://user-images.githubusercontent.com/66513003/116186105-efafb900-a75d-11eb-8015-e743d3132378.png)

### **종속성 찾기**
 - `{고객번호} -> {고객명}`  
 C1이면 무조건 유관순이고 C2면 무조건 손병희이므로 고객번호는 고객명을 종속한다. `True`

 - `{고객명} -> {등급}`
 유관순이면 GOLD이고 지청천이면 VIP이고 안중근이면 VIP이며 예외가 없으므로 고객명은 등급을 종속한다. `True`

 - `{고객번호, 고객명} -> {할인율}`
 {C1, 유관순}인 컬럼의 할인율을 5%이고, {C6, 윤봉길}의 할인율은 3%로 이며 등등 이에 예외가 없으므로 {고객번호, 고객명}은 할인율을 종속한다. `True`

 그러므로, `고객번호 -> {고객명, 등급, 할인율}`도 성립한다.

## **카노니컬 커버**

1. 함수적 종속성 추론 규칙으로 화장된 클로저에는 `자명한 종속성`과 `중복된 종속성`을 포함.
    - 자명한 종속성 : `A -> A 이다.` 자명한 사실.
    - 중복된 종속성 : `X -> AB, X -> B` 같은 의미가 여러번 존재.

2. 불필요한 함수적 종속성을 제거한 표준현으로 변환 후 정규화를 수행.

3. 표준형 조건
- F의 모든 함수적 종속성의 오른편 속성은 반드시 1개.  
    `{x,y} -> {z} (o)`  
    `{x} -> {a,b} (x) - 불가능하진 않지만 표준형이 아님.`
- F에서 X -> A를 X의 진부분집합 Y에 대하여 Y -> A로 교체했을 때, 그 집합이 F와 동등한 집합이 불가능.  
    `Y가 X의 부분집합이고, Y도 A를 종속할 때, X -> A는 있을 필요가 없다. (불필요한 것 배제, 가지치기)`
- F에서 어떤 함수적 종속성을 제거했을 떄, 그 집합이 F와 동등한 집합이 불가능.  
    `종속되는 항목을 뺐는데도 원본과 의미적으로 같다면 그 집합은 불필요.`

이렇게 모든 불필요한 요소를 제거해낸 것이 카노니컬 커버.  
- 순수한 요소의 함수적 종속성의 집합.
- 릴레이션을 효율적으로 개선.
- `F^c`로 표기한다.

# **3. 정규화**
- 정규형의 개념
- 제 2 정규형
- 제 3 정규형
- BC 정규형

## **정규형**

1. 이상 현상을 최소화 하도록 특정 조건을 갖춘 릴레이션의 형식
2. 정규형의 분류  
    `제 1 정규형 > 제 2 정규형 > 제 3 정규형 > BC 정규형 > 제 4 정규형 > 제 5 정규형`

## **정규화의 목적**
- 정의 : 
    `특정 정규형의 조건을 만족하도록 릴레이션과 속성을 재구성하는 과정`

1. 정규화의 기능
    - 데이터베이스 내에 모든 릴레이션을 효과적으로 표현
    - 보다 간단한 관계 연산에 깇하여 `검색 알고리즘`을 효과적으로 작성할 수 있도록 지원.
    - 바람직하지 않은 삽입, 수정, 삭제 등의 `이상 발생 방지`.
    - 새로운 형태의 데이터가 삽입될 때 `릴레이션 재구성의 필요성을 축소`.

    (DB모델링 - 요구분석 - 정규화 - 물리적 구현)

## **제 1 정규형**
1. 가장 조건이 단순한 정규형.
2. 관계형 모델에 조건에 따라 자동 적용되는 정규형.  
`릴레이션 스키마에서 정의된 모든 속성의 도메인이 원자값을 갖는 상태.`  
컬럼값의 원자성 : 컬럼 하나는 단 하나의 의미만을 갖는다.

### **제 1 정규화가 필요한 릴레이션**
<img src = "https://user-images.githubusercontent.com/66513003/116193548-7ff3fb00-a76a-11eb-9855-80f8e5ac850a.png" width= "400">

 - 김규식이 관리하는 도크에서 입항시간과 출항시간이 의미하는 바를 알 수 없다.

### **제 1 정규화를 적용**
 <img src = "https://user-images.githubusercontent.com/66513003/116194280-99e20d80-a76b-11eb-98b1-b44984fcf9bf.png" width= "400">

- 속성들이 원자값을 갖는다.

### **함수적 종속성 판별**
`임의의 릴레이션 스키마 R의 인스턴스 r(R)에 포함되는 서로 다른 두 레코드 t1, t2와 속성집한 X와 Y에 대해
t1[X] = t2[X]일 때, t1[y] = t2[y]이면, 함수적 종속성 X-> Y가 성립한다.`

- {도크번호} -> {도크관리자} `True`
- {목적} -> {담당도선사} `True`
- {목적} -> {도크번호} `True`

### **함수적 종속성 다이어그램 (Functional Dependency Diagram, FDD)**

1. 릴레이션 내의 속성간의 종속 관계를 직관적이고 이래하기 쉽게 도식화 한 표현 방식.
    - 직사각형 : 속성 또는 속성 집합.
    - 화살표 : 함수적 종속성.

<img src = "https://user-images.githubusercontent.com/66513003/116195085-b16dc600-a76c-11eb-859c-155525f74cba.png" width= "400">

### **제 2 정규형의 정의**
1. 릴레이션이 제 1 정규형을 만족하고 기본키의 부분집합이 특정 속성을 종속하고 있지 않은 상태.  
`주어진 릴레이션의 기본키가 아닌 속성들이 기본키에 완전히 종속되어 있는 상태.`

### **릴레이션의 무손실 분해**
1. 무손실 분해 (loseless decomposition)  
`스키마 𝑅에 함수적 종속성 𝑋 → 𝑌가 존재하고 𝑋 ∩ 𝑌 = ∅이면, 𝑅 을 𝑅 − 𝑌와 𝑋 𝑌로 분해.`

2. 도크관리 릴레이션 무손실 분해
 - {도크번호} ➝ {도크관리자}
 - {도크번호} ∩ {도크관리자} = Ø

 `도크관리를 {도크관리자},{도크번호, 도크관리자}로 분해`

### **제 2 정규화의 적용**


<img src = "https://user-images.githubusercontent.com/66513003/116196107-0bbb5680-a76e-11eb-8b51-617b49e9e27f.png" width= "400">

- 부분적으로 중복되던 컬럼들이 사라짐.

<img src = "https://user-images.githubusercontent.com/66513003/116196215-2d1c4280-a76e-11eb-9c29-9ffd4664e71d.png" width= "400">

- 도크관리자가 따로 떨어져 나와 다른 릴레이션으로 표현.

### **제 3 정규형의 정의**
`릴레이션이 제 2 정규형을 만족하고, 기본키가 아닌 속성들이 어떤 키에도 이행적으로 종속되지 않은 상태.

- 이행적 종속성 : `X -> Y이고 Y -> Z이면 X -> Z 이다.`

위 그림에서,   
{도크번호, 입항시간} -> {목적}  
{목적} -> {담당 도선사}  
{도크번호, 입항시간} -> {담당 도선사}
이런 이행적 종속성이 존재할 경우 부분적인 중복이 발생한다.

### **제 2 정규화의 적용**
<img src = "https://user-images.githubusercontent.com/66513003/116196865-f85cbb00-a76e-11eb-81c1-6faace31e545.png" width= "400">
<img src = "https://user-images.githubusercontent.com/66513003/116196962-17f3e380-a76f-11eb-8d59-bcffbb42ee77.png" width= "400">



### **BC 정규형의 정의**
`릴레이션이 제 3 정규형을 만족하고 릴레이션에 성립하는 X -> Y 형태의 모든 함수적 종속성에 대하여 X가 슈퍼키인 상태.`

1. 입출항관리 릴레이션의 함수적 종속성
    - {도크번호, 입항시간} -> {목적}
    - {도크번호, 입항시간} -> {출항시간}
    - {목적} -> {도크번호}

- 후보키중에 하나만 결정자가 될 수 있고, 일반적인 속성들은 절대로 결정자가 될 수 없다.  
- {목적}은 기본키가 아닌 일반속성인데 다른 속성을 종속한다. (BC 정규형 위배)


### **BC 정규화의 적용**
<img src = "https://user-images.githubusercontent.com/66513003/116198068-77062800-a770-11eb-81c7-45c877493eb6.png" width= "400">

- 결정자인 {목적}이 기본키인 {도크번호}를 대체하고
- {목적}은 {도크번호}를 종속한다.
- 종속자인 {도크번호}가 기본키에 있을수 없기 때문에.

<img src = "https://user-images.githubusercontent.com/66513003/116198358-d06e5700-a770-11eb-9c9e-301a101e1dec.png" width= "400">

<br>
<br>
<br>

## **정규화 결과**

<img src = "https://user-images.githubusercontent.com/66513003/116198633-2b07b300-a771-11eb-942b-65cc4cf8263a.png" width= "400">


### **역정규화의 개념**

1. 정규화
    - 릴레이션 분할을 통해 데이터의 중복성을 최소화 하는 과정
    - 사용 과정에서 많은 `조인 연산`을 유발

2. 역정규화
    - 정규화의 반대 과정
    - 정규화를 통해 분리되었던 릴레이션을 통합하는 재조정을 수행하고 정보의 부분적 중복을 허용하는 기법.
    - 데이터 접근 성능을 개선 목적.
3. 정규화되지 않은 스키마는 역정규화 스키마와는 다르다.
    - 두 스키마는 효율성, 구조측면에서 다르다.

#

# 정리
- 데이터베이스 모델링 과정에서 효율성을 위해 어떤 속성들을 그룹화하여 테이블로 작성할 것인지 고려할 필요가 있으며 전체적인 테이블 구조는 데이터베이스의 정확성을 판단하는 데 중요한 기준이 된다.

- 정규화는 데이터의 중복을 제거하고, 새로운 속성들이 데이터베이스에 추가될 때 기존 속성과의 관계에서 수정을 최소화해야 한다는 것이 목적이다. 따라서 정규화 과정을 통해 데이터 저장을 위한 공간의 낭비를 최소화 할 수 있다.

- 정규화 이전에 데이터베이스 조작에서 발생하는 삽입, 삭제, 수정 등의 갱신 이상 현상을 정규화를 통해 방지할 수 있다.

- 속성들 간의 연관관계를 표현한 함수적 종속성은 릴레이션의 효율성 여부에 중요한 판단기준이 되지만 릴레이션의 인스턴스만으로 잠재된 모든 함수적 종속성을 찾아내기 어렵기 때문에 이를 확장하기 위해 `암스트롱 공리`를 적용하여 클로저로 확장한다.

- 도출된 클로저에는 자명한 함수적 종속성이나 중복된 함수적 종속성을 포함하고 있으므로 이러한 불필요한 종속성을 제거한 `카노니컬 커버`를 사용하여 정규화를 진행한다.

- 함수적 종속성은 릴레이션 스키마의 속성들 사이에 명시되는 기본적인 제약조건이다. 함수적 종속성에 의한 방법과 추론하는 방법을 바탕으로 기본적인 정규형을 구성할 수 있다.

- 정규형의 만족시켜야 하는 제약조건에 따라 제1정규형, 제2정규형, 제3정규형, BC정규형, 제4정규형, 제5정규형 순서로 진행된다. 정규형의 조건은 정규화가 진행될수록 강화된다.